# 注册登录

## 注册 
需要前台验证   手机号 密码 协议 验证码 
1. api 
  - `export const reqReginster = (userInfo) => ajax.post('/user/passport/register', userInfo)`

2. vuex
    ```js
        async register({commit},userInfo){
            const result = await reqReginster(userInfo)
            if(result.code!==200){
                throw new Error(result.data || result.message || "注册失败")
            }
        } 
    ```
3. component
    ```js
        methods:{
            updateCode(){
                this.$refs.code.src = '/api/user/passport/code'
            },
            async register(){
                // 获取数据
                const {mobile, password, password2, code, isAgree} = this
                //判断 
                if(!isAgree){
                    alert('必须同意用户协议方可注册')
                    return
                }else if( password!==password2){
                    alert('两次密码必须一致')
                    return 
                }
                try{
                    await this.$store.dispatch('register',{mobile, password, code})
                    // 成功跳转登录页面
                    this.$router.replace('/login')
                }catch(error){
                    this.updateCode()
                    this.$refs.code = ''
                    alert(error.message)
                }
            }
        }
    ````

## 登录
需要利用localStorage进行本地存储登录数据 当登录成功后跳转首页 并且header组件中的状态要改变 利用 v-if 和 v-else  
1. api
    ```js
        export function reqLogin(mobile,password){
            return ajax({
                method:'POST',
                url:'/user/passport/login',
                data:{mobile,password}      //传参要用data对象
            })
            // 可用对象形式  
            // return ajax.post('/user/passport/login', {mobile,password})
        }
    ```
2. vuex
  - 异步action 
    - ```js
         async login({commit},{mobile,password}){
            const result = await reqLogin(mobile,password)
            if(result.code === 200){
                // 成功 获取userInfo的数据
                const userInfo = result.data
                commit('RECEIVE_USER_INFO',userInfo)
                localSet(userInfo)
            }else{
                throw new Error(result.data || result.message || '登录失败')
            }
        },
    ```
3. component
  ```js
    methods:{
      async login(){
        const {mobile, password} = this
        try{
          await this.$store.dispatch('login',{mobile,password})
          // 登录成功  跳转到首页
          this.$router.replace('/')
        }catch(error){
          alert(error.message)
        }
      }
    }
    ```